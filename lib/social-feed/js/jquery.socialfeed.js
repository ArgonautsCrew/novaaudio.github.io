"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),function(t,e,a,i){t.fn.socialfeed=function(e){function a(){u.forEach(function(t){o[t]&&(l+=o[t].accounts?o[t].limit*o[t].accounts.length:o[t].limit)})}function s(){var t=!0;t&&o.callback&&o.callback()}function n(t,e){this.content=e,this.content.social_network=t,this.content.attachment=this.content.attachment===i?"":this.content.attachment,this.content.time_ago=e.dt_create.fromNow(),this.content.date=e.dt_create.format(o.date_format),this.content.dt_create=this.content.dt_create.valueOf(),this.content.text=p.wrapLinks(p.shorten(e.message+" "+e.description),e.social_network),this.content.moderation_passed=o.moderation?o.moderation(this.content):!0,d[t].posts.push(this)}var r={plugin_folder:"",template:"template.html",show_media:!1,media_min_width:300,length:256,date_format:"ll"},o=t.extend(r,e),c=t(this),u=["facebook","instagram","vk","google","blogspot","twitter","pinterest","rss"],l=0,m=0;a();var p={request:function(e,a){t.ajax({url:e,dataType:"jsonp",success:a})},get_request:function(e,a){t.get(e,a,"json")},wrapLinks:function(t,e){var a=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;return t="google-plus"===e?t.replace(/(@|#)([a-z0-9_]+['])/gi,p.wrapGoogleplusTagTemplate):t.replace(a,p.wrapLinkTemplate)},wrapLinkTemplate:function(t){return'<a target="_blank" href="'+t+'">'+t+"</a>"},wrapGoogleplusTagTemplate:function(t){return'<a target="_blank" href="https://plus.google.com/s/'+t+'" >'+t+"</a>"},shorten:function(e){return e=t.trim(e),e.length>o.length?jQuery.trim(e).substring(0,o.length).split(" ").slice(0,-1).join(" ")+"...":e},stripHTML:function(t){return"undefined"==typeof t||null===t?"":t.replace(/(<([^>]+)>)|nbsp;|\s{2,}|/gi,"")}};n.prototype={render:function(){var e=d.template(this.content),a=this.content;if(0!==t(c).children("[social-feed-id="+a.id+"]").length)return!1;if(0===t(c).children().length)t(c).append(e);else{var i=0,n=-1;if(t.each(t(c).children(),function(){return t(this).attr("dt-create")<a.dt_create?(n=i,!1):void i++}),t(c).append(e),n>=0){n++;var r=t(c).children("div:nth-child("+n+")"),u=t(c).children("div:last-child");t(u).insertBefore(r)}}if(o.media_min_width){var p="[social-feed-id="+a.id+"] img.attachment",h=t(p),g=new Image,f=h.attr("src");t(g).load(function(){g.width<o.media_min_width&&h.hide(),delete g}).error(function(){h.hide()}).attr({src:f})}m++,m==l&&s()}};var d={template:!1,init:function(){d.getTemplate(function(){u.forEach(function(t){o[t]&&(o[t].accounts?o[t].accounts.forEach(function(e){d[t].getData(e)}):o[t].urls?o[t].urls.forEach(function(e){d[t].getData(e)}):d[t].getData())})})},getTemplate:function(e){return d.template?e():o.template_html?(d.template=doT.template(o.template_html),e()):void t.get(o.template,function(t){return d.template=doT.template(t),e()})},twitter:{posts:[],loaded:!1,api:"http://api.tweecool.com/",userdata:null,tpl_class:"",getData:function(t){var e=new Codebird;switch(e.setConsumerKey(o.twitter.consumer_key,o.twitter.consumer_secret),o.twitter.proxy!==i&&e.setProxy(o.twitter.proxy),t[0]){case"@":var a=t.substr(1);e.__call("statuses_userTimeline","id="+a+"&count="+o.twitter.limit,d.twitter.utility.getPosts,!0);break;case"#":var s=t.substr(1);e.__call("search_tweets","q="+s+"&count="+o.twitter.limit,function(t){d.twitter.utility.getPosts(t.statuses)},!0)}},utility:{getPosts:function(e){e&&t.each(e,function(){var t=this,e=new n("twitter",d.twitter.utility.unifyPostData(t));e.render()})},unifyPostData:function(t){var e={};if(t.id&&(e.id=t.id,e.tpl_class=o.twitter.tpl_class,e.dt_create=moment(new Date(t.created_at)),e.author_link="http://twitter.com/"+t.user.screen_name,e.author_picture=t.user.profile_image_url,e.post_url=e.author_link+"/status/"+t.id_str,e.author_name=t.user.name,e.message=t.text,e.description="",e.link="http://twitter.com/"+t.user.screen_name+"/status/"+t.id_str,t.entities.user_mentions.length>0&&(e.user_name=t.entities.user_mentions[0].name,e.user_url="http://twitter.com/"+t.entities.user_mentions[0].screen_name),o.show_media===!0&&t.entities.media&&t.entities.media.length>0)){var a=t.entities.media[0].media_url;a&&(e.attachment='<img class="attachment" src="'+a+'" />')}return e}}},facebook:{posts:[],graph:"https://graph.facebook.com/",loaded:!1,getData:function(t){var e=function(t){p.request(t,d.facebook.utility.getPosts)},a="?fields=id,from,name,message,created_time,story,description,link";a+=o.show_media===!0?",picture,object_id":"";var i,s="&limit="+o.facebook.limit,n="&access_token="+o.facebook.access_token+"&callback=?";switch(t[0]){case"@":var r=t.substr(1);d.facebook.utility.getUserId(r,function(t){""!==t.id&&(i=d.facebook.graph+"v2.4/"+t.id+"/posts"+a+s+n,e(i))});break;case"!":var c=t.substr(1);i=d.facebook.graph+"v2.4/"+c+"/feed"+a+s+n,e(i);break;default:e(i)}},utility:{getUserId:function(e,a){var i="&access_token="+o.facebook.access_token+"&callback=?",s="https://graph.facebook.com/"+e+"?"+i;t.get(s,a,"json")},prepareAttachment:function(t){var e=t.picture;return-1!==e.indexOf("_b.")||(-1!==e.indexOf("safe_image.php")?e=d.facebook.utility.getExternalImageURL(e,"url"):-1!==e.indexOf("app_full_proxy.php")?e=d.facebook.utility.getExternalImageURL(e,"src"):t.object_id&&(e=d.facebook.graph+t.object_id+"/picture/?type=normal")),'<img class="attachment" src="'+e+'" />'},getExternalImageURL:function(t,e){return t=decodeURIComponent(t).split(e+"=")[1],-1===t.indexOf("fbcdn-sphotos")?t.split("&")[0]:t},getPosts:function(t){t.data&&t.data.forEach(function(t){var e=new n("facebook",d.facebook.utility.unifyPostData(t));e.render()})},unifyPostData:function(t){var e={},a=t.message?t.message:t.story;if(e.id=t.id,e.dt_create=moment(t.created_time),e.author_link="http://facebook.com/"+t.from.id,e.author_picture=d.facebook.graph+t.from.id+"/picture",e.author_name=t.from.name,e.name=t.name||"",e.message=a?a:"",e.description=t.description?t.description:"",e.link=t.link?t.link:"http://facebook.com/"+t.from.id,o.show_media===!0&&t.picture){var i=d.facebook.utility.prepareAttachment(t);i&&(e.attachment=i)}return e}}},google:{posts:[],loaded:!1,api:"https://www.googleapis.com/plus/v1/",getData:function(t){var e;switch(t[0]){case"#":var a=t.substr(1);e=d.google.api+"activities?query="+a+"&key="+o.google.access_token+"&maxResults="+o.google.limit,p.get_request(e,d.google.utility.getPosts);break;case"@":var i=t.substr(1);e=d.google.api+"people/"+i+"/activities/public?key="+o.google.access_token+"&maxResults="+o.google.limit,p.get_request(e,d.google.utility.getPosts)}},utility:{getPosts:function(e){e.items&&t.each(e.items,function(t){var a=new n("google",d.google.utility.unifyPostData(e.items[t]));a.render()})},unifyPostData:function(e){var a={};return a.id=e.id,a.attachment="",a.description="",a.dt_create=moment(e.published),a.author_link=e.actor.url,a.author_picture=e.actor.image.url,a.author_name=e.actor.displayName,o.show_media===!0&&e.object.attachments&&t.each(e.object.attachments,function(){var t="";this.fullImage?t=this.fullImage.url:"album"===this.objectType&&this.thumbnails&&this.thumbnails.length>0&&this.thumbnails[0].image&&(t=this.thumbnails[0].image.url),a.attachment='<img class="attachment" src="'+t+'"/>'}),a.message=e.title,a.link=e.url,a}}},instagram:{posts:[],api:"https://api.instagram.com/v1/",loaded:!1,userdata:null,tpl_class:"",accessType:function(){return"undefined"==typeof o.instagram.access_token&&"undefined"==typeof o.instagram.client_id?(console.log("You need to define a client_id or access_token to authenticate with Instagram's API."),i):(o.instagram.access_token&&(o.instagram.client_id=i),o.instagram.access_type="undefined"==typeof o.instagram.client_id?"access_token":"client_id",o.instagram.access_type)},getData:function(t){var e;if("undefined"!==this.accessType())var a=o.instagram.access_type+"="+o.instagram[o.instagram.access_type];switch(t[0]){case"@":var i=t.substr(1);e=d.instagram.api+"users/search/?q="+i+"&"+a+"&count=1&callback=?",p.request(e,d.instagram.utility.getUsers);break;case"#":var s=t.substr(1);e=d.instagram.api+"tags/"+s+"/media/recent/?"+a+"&count="+o.instagram.limit+"&callback=?",p.request(e,d.instagram.utility.getImages);break;case"&":var n=t.substr(1);e=d.instagram.api+"users/"+n+"/?"+a+"&count="+o.instagram.limit+"&callback=?",p.request(e,d.instagram.utility.getUsers);case"*":var i=o.instagram.userdata;e=d.instagram.api+"users/search/?q="+i+"&count="+o.instagram.limit+"&"+a,p.request(e,d.instagram.utility.getUsers)}},utility:{getImages:function(t){t.data&&t.data.forEach(function(t){var e=new n("instagram",d.instagram.utility.unifyPostData(t));e.render()})},getUsers:function(t){if("undefined"!==o.instagram.access_type)var e=o.instagram.access_type+"="+o.instagram[o.instagram.access_type];jQuery.isArray(t.data)||(t.data=[t.data]),t.data.forEach(function(t){var a=d.instagram.api+"users/"+t.id+"/media/recent/?"+e+"&count="+o.instagram.limit+"&callback=?";t.username===o.instagram.userdata&&p.request(a,d.instagram.utility.getImages)})},unifyPostData:function(t){var e={};return e.tpl_class=o.instagram.tpl_class,e.id=t.id,e.comment=t.comments.count?t.comments.count:0,e.likes=t.likes.count?t.likes.count:0,e.dt_create=moment(1e3*t.created_time),e.author_link="http://instagram.com/"+t.user.username,e.author_picture=t.user.profile_picture,e.author_name=t.user.full_name||t.user.username,e.message=t.caption&&t.caption?t.caption.text:"",e.description="",e.link=t.link,o.show_media&&(e.attachment='<img class="attachment" src="'+t.images.standard_resolution.url+'" />'),e}}},vk:{posts:[],loaded:!1,base:"http://vk.com/",api:"https://api.vk.com/method/",user_json_template:"https://api.vk.com/method/users.get?fields=first_name,%20last_name,%20screen_name,%20photo&uid=",group_json_template:"https://api.vk.com/method/groups.getById?fields=first_name,%20last_name,%20screen_name,%20photo&gid=",getData:function(t){var e;switch(t[0]){case"@":var a=t.substr(1);e=d.vk.api+"wall.get?owner_id="+a+"&filter="+o.vk.source+"&count="+o.vk.limit+"&callback=?",p.get_request(e,d.vk.utility.getPosts);break;case"#":var i=t.substr(1);e=d.vk.api+"newsfeed.search?q="+i+"&count="+o.vk.limit+"&callback=?",p.get_request(e,d.vk.utility.getPosts)}},utility:{getPosts:function(e){e.response&&t.each(e.response,function(){if(this!=parseInt(this)&&"post"===this.post_type){var t=this.owner_id?this.owner_id:this.from_id,a=t>0?d.vk.user_json_template+t+"&callback=?":d.vk.group_json_template+-1*t+"&callback=?",i=this;p.get_request(a,function(t){d.vk.utility.unifyPostData(t,i,e)})}})},unifyPostData:function(t,e,a){var i={};if(i.id=e.id,i.dt_create=moment.unix(e.date),i.description=" ",i.message=p.stripHTML(e.text),o.show_media&&e.attachment&&("link"===e.attachment.type&&(i.attachment='<img class="attachment" src="'+e.attachment.link.image_src+'" />'),"video"===e.attachment.type&&(i.attachment='<img class="attachment" src="'+e.attachment.video.image_big+'" />'),"photo"===e.attachment.type&&(i.attachment='<img class="attachment" src="'+e.attachment.photo.src_big+'" />')),e.from_id>0){var s=d.vk.user_json_template+e.from_id+"&callback=?";p.get_request(s,function(t){var s=new n("vk",d.vk.utility.getUser(t,i,e,a));s.render()})}else{var r=d.vk.group_json_template+-1*e.from_id+"&callback=?";p.get_request(r,function(t){var s=new n("vk",d.vk.utility.getGroup(t,i,e,a));s.render()})}},getUser:function(t,e,a,i){return e.author_name=t.response[0].first_name+" "+t.response[0].last_name,e.author_picture=t.response[0].photo,e.author_link=d.vk.base+t.response[0].screen_name,e.link=d.vk.base+t.response[0].screen_name+"?w=wall"+a.from_id+"_"+a.id,e},getGroup:function(t,e,a,i){return e.author_name=t.response[0].name,e.author_picture=t.response[0].photo,e.author_link=d.vk.base+t.response[0].screen_name,e.link=d.vk.base+t.response[0].screen_name+"?w=wall-"+t.response[0].gid+"_"+a.id,e}}},blogspot:{loaded:!1,getData:function(t){var e;switch(t[0]){case"@":var a=t.substr(1);e="http://"+a+".blogspot.com/feeds/posts/default?alt=json-in-script&callback=?",request(e,getPosts)}},utility:{getPosts:function(e){t.each(e.feed.entry,function(){var t={},e=this;t.id=e.id.$t.replace(/[^a-z0-9]/gi,""),t.dt_create=moment(e.published.$t),t.author_link=e.author[0].uri.$t,t.author_picture="http:"+e.author[0].gd$image.src,t.author_name=e.author[0].name.$t,t.message=e.title.$t+"</br></br>"+stripHTML(e.content.$t),t.description="",t.link=e.link.pop().href,o.show_media&&e.media$thumbnail&&(t.attachment='<img class="attachment" src="'+e.media$thumbnail.url+'" />'),t.render()})}}},pinterest:{posts:[],loaded:!1,apiv1:"https://api.pinterest.com/v1/",getData:function(t){var e,a="limit="+o.pinterest.limit,i="fields=id,created_at,link,note,creator(url,first_name,last_name,image),image",s=i+"&access_token="+o.pinterest.access_token+"&"+a+"&callback=?";switch(t[0]){case"@":var n=t.substr(1);e="me"===n?d.pinterest.apiv1+"me/pins/?"+s:d.pinterest.apiv1+"boards/"+n+"/pins?"+s}p.request(e,d.pinterest.utility.getPosts)},utility:{getPosts:function(t){t.data.forEach(function(t){var e=new n("pinterest",d.pinterest.utility.unifyPostData(t));e.render()})},unifyPostData:function(t){var e={};return e.id=t.id,e.dt_create=moment(t.created_at),e.author_link=t.creator.url,e.author_picture=t.creator.image["60x60"].url,e.author_name=t.creator.first_name+t.creator.last_name,e.message=t.note,e.description="",e.social_network="pinterest",e.link=t.link?t.link:"https://www.pinterest.com/pin/"+t.id,o.show_media&&(e.attachment='<img class="attachment" src="'+t.image.original.url+'" />'),e}}},rss:{posts:[],loaded:!1,api:"https://ajax.googleapis.com/ajax/services/feed/load?v=1.0",getData:function(t){var e="&num="+o.rss.limit,a=d.rss.api+e+"&q="+encodeURIComponent(t);p.request(a,d.rss.utility.getPosts)},utility:{getPosts:function(e){t.each(e.responseData.feed.entries,function(t,e){var a=new n("rss",d.rss.utility.unifyPostData(t,e));a.render()})},unifyPostData:function(t,e){var a={};return a.id=t,a.dt_create=moment(e.publishedDate,"ddd, DD MMM YYYY HH:mm:ss ZZ","en"),a.author_link="",a.author_picture="",a.author_name=e.author,a.message=p.stripHTML(e.title),a.description=p.stripHTML(e.content),a.social_network="rss",a.link=e.link,o.show_media&&e.mediaGroups&&(a.attachment='<img class="attachment" src="'+e.mediaGroups[0].contents[0].url+'" />'),a}}}};return this.each(function(){d.init(),o.update_period&&setInterval(function(){return d.init()},o.update_period)})}}(jQuery);